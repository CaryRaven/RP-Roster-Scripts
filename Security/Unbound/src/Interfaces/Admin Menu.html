<!DOCTYPE html>
<html>

<head>
  <title>Main Web App: Security Admin Menu</title>
  <base target="_top">
  <link href='https://fonts.googleapis.com/css?family=Lexend' rel='stylesheet'>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <?!= include("Interfaces/CSS"); ?>
</head>

<body>

  <div class="lockdown-banner" style="display: none;" id="lockdown-topbanner">ðŸš¨ <?= factionName ?> Documentation is currently under lockdown ðŸš¨</div>
  <p id="viewChange" style="font-size: 0px;"><?= viewChange ?></p>

  <script>
    document.addEventListener("DOMContentLoaded", function () {

      window.CloseChangelog =  function(event) {
        try { event.preventDefault(); } catch(e) { }
        document.getElementById("update-popup").setAttribute("style", "display: none;");
        document.getElementById("changeLoader").setAttribute("style", "display: none;");
        document.getElementById("admin-menu").setAttribute("style", "display: block;");
      }

      window.Shake = function() {
        document.body.classList.add('shake');
        setTimeout(() => document.body.classList.remove('shake'), 200);
      };

      window.SetSpecSelects = function() {
        google.script.run.withSuccessHandler(specs => {
          document.getElementById("specfield").innerHTML = "";
          document.getElementById("removeSpec").innerHTML = "";
          const editSpec = document.getElementById("editSpecSelect").value;

          if (editSpec == "") document.getElementById("editSpecSelect").innerHTML = "";
          specs = JSON.parse(specs);

          specs.forEach(spec => {
            const specOption = document.createElement("option");
            specOption.innerText = spec.title;
            document.getElementById("specfield").appendChild(specOption);

            const specOptionConfig = document.createElement("option");
            specOptionConfig.innerText = spec.title;
            document.getElementById("removeSpec").appendChild(specOptionConfig);

            if (editSpec == "") {  
              const specOptionConfig2 = document.createElement("option");
              specOptionConfig2.innerText = spec.title;
              document.getElementById("editSpecSelect").appendChild(specOptionConfig2);
            }
          });
        }).ReturnSpecs();
      };

      window.SetRankSelects = function() {
        let initRanks = document.getElementById("ranks")?.innerText;
        let rankSelect = document.getElementById("amdin-role-select");
        let rankRowSelect = document.getElementById("new-rank-select");
        let addRankSelect = document.getElementById("new-rank-before-select");
        let removeRankSelect = document.getElementById("remove-rank-select");
        const editRankSelect = document.getElementById("editRankSelect");

        if (initRanks) {
          initRanks = initRanks.split(",");
        } else {
          initRanks = [];
        }

        rankSelect.innerHTML = '<option value=""></option>';
        rankRowSelect.innerHTML = '<option value=""></option>';
        removeRankSelect.innerHTML = '<option value=""></option>';

        if (editRankSelect.value === "" && addRankSelect.value === "") {
          addRankSelect.innerHTML = '<option value=""></option>';
          editRankSelect.innerHTML = '<option value=""></option>';
        }

        initRanks.forEach(rankName => {
          const rankOption = document.createElement("option");
          rankOption.value = rankName;
          rankOption.innerText = rankName;
          rankSelect.appendChild(rankOption);

          if (!rankName.includes("Site") && !rankName.includes("Chief")) {
            const rankRowOption = document.createElement("option");
            rankRowOption.value = rankName;
            rankRowOption.innerText = rankName;
            rankRowSelect.appendChild(rankRowOption);

            if (editRankSelect.value == "" && addRankSelect.value === "") {
              const addRankOption = document.createElement("option");
              addRankOption.value = rankName;
              addRankOption.innerText = rankName;
              addRankSelect.appendChild(addRankOption);

              const editRankOption = document.createElement("option");
              editRankOption.value = rankName;
              editRankOption.innerText = rankName;
              editRankSelect.appendChild(editRankOption);
            }

            const removeRankOption = document.createElement("option");
            removeRankOption.value = rankName;
            removeRankOption.innerText = rankName;
            removeRankSelect.appendChild(removeRankOption);
          }
        });
      };

      window.SetSliders = function() {
        google.script.run.withSuccessHandler(r => {
          document.getElementById('manualEditingSlider').checked = !(r === "true");
        }).ReturnManualEditing();

        google.script.run.withSuccessHandler(re => {
            document.getElementById('backupSlider').checked = (re === "true");
        }).ReturnBackup();

        google.script.run.withSuccessHandler(res => {
          if (res === "true") {
            document.getElementById('lockdown-topbanner').style.display = "block";
            document.getElementById('lockdownIdentifier').innerText = "Disable";
          } else {
            document.getElementById('lockdownIdentifier').innerText = "Enable";
          }
        }).ReturnLockdown();

        google.script.run.withSuccessHandler(r => {
          document.getElementById('pingSlider').checked = (r === "true");
        }).ReturnPings();
      };
    });
  </script>
  <div class="loader" id="changeLoader"></div>
  <div id="update-popup" class="main-content" style="display: none;">
    <div class="container">
      <div class="textbox">
        <h1>ChangeLog: <?= changeDate; ?></span></h1><br>
        <h3>There has been an update to this admin menu, please read the changelogs below to stay up to date with the latest changes.</h3><br>
        <hr><br>
        <div class="changelog">
          <h3>Update Notes:</h3><br>
          <ul id="changeLogList">
          </ul>
        </div>
        <button class="submitButton-mini" onclick="CloseChangelog(event)" style="margin-top: 50px;">Close</button>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let viewChange = document.getElementById("viewChange");
      let ul = document.getElementById("changeLogList");
      if (viewChange.innerText == "false") {
        CloseChangelog();
      } else {
        google.script.run.withSuccessHandler(property => {
          property = JSON.parse(property);
          const notes = property.fields;

          notes.forEach(note => {
            const noteLi = document.createElement("li");
            noteLi.innerText = note;
            ul.appendChild(noteLi);
          });
          document.getElementById("update-popup").setAttribute("style", "display: block;");
          document.getElementById("changeLoader").setAttribute("style", "display: none;");
        }).withFailureHandler(() => {
          document.getElementById("update-popup").setAttribute("style", "display: block;");
          document.getElementById("changeLoader").setAttribute("style", "display: none;");
          ul.innerHTML = "<li>Something went wrong while loading the changelogs</li>"
        }).GetChangeNotes();
      }
    });
  </script>

  <div id="admin-menu" style="display: none;">
    <!-- Sidebar NAVIGATION - Permanently displayed -->
    <script>
      // Panel Visibility Toggles => Operated by sidebar
      let configupdate;
      function ShowDash() {
        document.getElementById('dashboard').setAttribute('style', 'display: block;');
        document.getElementById('data-forms').setAttribute('style', 'display: none;');
        document.getElementById('usermanual').setAttribute('style', 'display: none;');
        // document.getElementById('connections').setAttribute('style', 'display: none;');
        document.getElementById('search_panel').setAttribute('style', 'display: none;');
        try {
          document.getElementById('config').setAttribute('style', 'display: none;'); 
          clearInterval(configupdate);
          SetRankSelects();
          setInterval(() => {
            SetRankSelects();
          }, 10000);
        } catch (e) {  }
      }

      function ShowManual() {
        document.getElementById('dashboard').setAttribute('style', 'display: none;');
        document.getElementById('data-forms').setAttribute('style', 'display: none;');
        document.getElementById('usermanual').setAttribute('style', 'display: block;');
        // document.getElementById('connections').setAttribute('style', 'display: none;');
        document.getElementById('search_panel').setAttribute('style', 'display: none;');
        try { 
          document.getElementById('config').setAttribute('style', 'display: none;'); 
          clearInterval(configupdate); 
        } catch (e) {  }
      }

      function ShowConnections() {
        document.getElementById('dashboard').setAttribute('style', 'display: none;');
        document.getElementById('data-forms').setAttribute('style', 'display: none;');
        document.getElementById('usermanual').setAttribute('style', 'display: none;');
        // document.getElementById('connections').setAttribute('style', 'display: block;');
        document.getElementById('search_panel').setAttribute('style', 'display: none;');
       try { 
          document.getElementById('config').setAttribute('style', 'display: none;'); 
          clearInterval(configupdate); 
        } catch (e) {  }
      }

      function ShowSearch() {
        document.getElementById('dashboard').setAttribute('style', 'display: none;');
        document.getElementById('data-forms').setAttribute('style', 'display: none;');
        document.getElementById('usermanual').setAttribute('style', 'display: none;');
        // document.getElementById('connections').setAttribute('style', 'display: none;');
        document.getElementById('search_panel').setAttribute('style', 'display: block;');
        document.getElementById("searchLoading").setAttribute("style", "display: none;");
        try { 
          document.getElementById('config').setAttribute('style', 'display: none;'); 
          clearInterval(configupdate); 
        } catch (e) {  }
      }

      function ShowConfig() {
        document.getElementById('dashboard').setAttribute('style', 'display: none;');
        document.getElementById('data-forms').setAttribute('style', 'display: none;');
        document.getElementById('usermanual').setAttribute('style', 'display: none;');
        // document.getElementById('connections').setAttribute('style', 'display: none;');
        document.getElementById('search_panel').setAttribute('style', 'display: none;');
        document.getElementById('config').setAttribute('style', 'display: block;');
        try { clearInterval(configupdate); } catch(e) { }

        // Making sure the config is synced every 10 seconds
        SetSpecSelects();
        SetRankSelects();
        SetSliders();
        configupdate = setInterval(() => {
          SetSpecSelects();
          SetRankSelects();
          SetSliders();
        }, 10000);
      }
    </script>
    <div class="sidebar">
      <div class="top">
        <!-- THIS DIV IS FULLY HIIDEN -(importing images don't work) -->
        <div class="logo">
          <i class="bx bxl-codepen"></i>
          <span>Admin Menu</span>
        </div>
        <i class="https://drive.google.com/uc?export=view&id=1pftsKrkMT4231wMYCVDyvWPdcDT4nuqP" id="btn"></i>
      </div>
      <!-------------------------------->
      <ul>
        <li>
          <button onclick="ShowDash()">
            <i class="bx bxs-dashboard bx-tada-hover"></i>
            <span class="tooltip">Dashboard</span>
          </button>
        </li>
        <li>
          <a href="https://docs.google.com/spreadsheets/d/1LpkjzBEoOSmw41dDLwONE2Gn9mhSGb5GaiCApnhI3JE/edit?usp=sharing"
            target="_blank">
            <button>
              <i class="bx bx-grid bx-tada-hover"></i>
              <span class="tooltip">Roster</span>
            </button>
          </a>
        </li>
        <!-- <li>
          <button onclick="ShowConnections()">
            <i class='bx bx-link bx-tada-hover'></i>
            <span class="tooltip">Connections</span>
          </button>
        </li> -->
        <li>
          <button onclick="ShowManual()">
            <i class="bx bxs-book-bookmark bx-tada-hover"></i>
            <span class="tooltip">Manual</span>
          </button>
        </li>
        <li>
          <button onclick="ShowSearch()">
            <i class='bx bx-search-alt-2 bx-tada-hover'></i>
            <span class="tooltip">Search</span>
          </button>
        </li>
        <li>
          <button onclick="ShowConfig()">
            <i class='bx bx-shield-quarter bx-tada-hover'></i>
            <span class="tooltip">Config</span>
          </button>
        </li>
        <!-- <li>
          <button onclick="">
            <i class='bx bx-bell bx-tada-hover' ></i>
            <span class="tooltip">Notifications</span>
          </button>
        </li> -->
      </ul>
    </div>

    <!-- Dashboard (with options to go to forms) -->
    <script>
      // Form Toggles => Operated by option-box divs

      function OpenLogForm() {
        document.getElementById('dashboard').setAttribute('style', 'display: none;');
        document.getElementById('loggerForm').setAttribute('style', 'display: flex;');
        document.getElementById('data-forms').setAttribute('style', 'display: block;');
        document.getElementById('editForm').setAttribute('style', 'display: none;');
      }

      function OpenEditForm() {
        document.getElementById('dashboard').setAttribute('style', 'display: none;');
        document.getElementById('editForm').setAttribute('style', 'display: block;');
        document.getElementById('data-forms').setAttribute('style', 'display: block;');
        document.getElementById('loggerForm').setAttribute('style', 'display: none;');
      }
    </script>
    <div class="main-content" id="dashboard">
      <div class="container">
        <div class="textbox">
          <h1>Admin Menu</h1><br>
          <h3>This menu is only to be accessed by individuals authorized to edit the <?= factionName ?> Roster.<br>
            If you are here unauthorized, no function will work.
          </h3><br>
          <hr><br>
          <p>If you would be confused about what to do, don't be afraid to consult the <?= factionName ?> Leadership Handbook or ask
            your superior for help.<br>
            This page is where all <?= factionName ?> roster edits are made, our systems do everything automatically so do not worry
            about handling permissions or such.<br>
            If you would want manual changes to be made, please consult the owner of the roster.</p><br><br>
          <p style="font-weight: bold; font-size: 17px;">Click on either one of the below options to use the Admin Menu
          </p>
          <div class="box-container">
            <button class="option-box" onclick="OpenLogForm()">
              <div class="button-text-align">
                <h3> <i class="bx bxs-wrench"></i> Submit a Log</h3> <br>
                <hr> <br>
                <p>Select this option if you would like to perform basic roster operations such as submitting a log or
                  making a rank change. <br> <br>
                  This can include things like: <br> <br>
                  Rank Changes <br>
                  Infraction Logs <br>
                  Blacklists <br>
                  etc...
                </p>
              </div>
            </button>
            <button class="option-box" onclick="OpenEditForm()">
              <div class="button-text-align">
                <h3> <i class="bx bx-edit"></i> Modify Personnel Info</h3> <br>
                <hr> <br>
                <p>Select this option if you would like to modify specific information about a <?= factionName ?> member. <br><br>
                  This can include things like: <br><br>
                  Name <br>
                  Steam ID <br>
                  Discord ID <br>
                  Email-address <br>
                  etc...
                </p>
              </div>
            </button>
          </div>
          <table class="config-switches" style="margin-top: 30px; display: none;" id="terminalConfig">
              <td>
                Enabled/Disable terminal animation when opening admin menu:
              </td>
              <td class="config-switch">
                <label class="switch">
                  <input type="checkbox" id="showTerminalSlider">
                  <span class="slider round"></span>
                </label>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <script>
      google.script.run.withSuccessHandler((response) => {
        document.getElementById("showTerminalSlider").checked = (response === "true");
        document.getElementById("terminalConfig").style.display = "block";
        console.log(response);
      }).ReturnTerminalSetting();

      try {
        document.getElementById('showTerminalSlider').addEventListener('change', function () {
          google.script.run.withSuccessHandler((response) => {
            document.getElementById("showTerminalSlider").checked = (response === "true");
            console.log(response);
          }).ToggleTerminal(this.checked);
        });
      } catch(e) {
        console.log("Terminal failed");
      }
    </script>

    <!-- Connections -->
    <!-- <div class="main-content" id="connections" style="display: none;">
      <div class="container">
        <div class="textbox">
          <h1>Connections</h1><br>
          <p>This page contains other rosters/admin menus for quick navigation.</p>
        </div>
      </div>
    </div> -->

    <!-- User Manual -->
    <div class="main-content" id="usermanual" style="display: none;">
      <div class="container">
        <div class="textbox">
          <h1><i class="bx bxs-book-bookmark"></i>User Manual</h1><br>
          <p>In this manual I will explain all the necessary things you will need to know in order to operate this Admin
            Menu. Alongside this, I will also go into more detail about how some of these functions work at the end of the
            manual if you are curious. You can always consult your supervisor if you would be unsatisfied with the level
            of detail of this manual, in which case they can provide you with more information.</p><br>
          <hr><br>
          <p>
            <strong>Before we begin I must emphasize: NEVER edit the <?= factionName ?> roster directly unless you know very well what you're doing. The whole reason why this
              admin menu was made is so you don't have to make direct edits to the spreadsheet itself. Why you might ask?
              This is because the Admin Menu performs a lot of operations behind the scenes, such as managing document access.
              If you add a staff member manually you will also have to manually give them permissions to all the folders.
              Using this UI might seem slow and inefficient, but trust me that you are saving yourself a lot of time &
              effort. In order to prevent human error, please use the admin menu. Thanks :)</strong>
          </p><br>
          <div class="box-container" id="manual-box">
            <div class="dashboard-manual">
              <p class="left-text">The main reason why you would access the Admin Menu is, of course, to manage the <?= factionName ?>
                Roster. In order to do this, you must access the "dashboard" using the sidebar to your right. There you
                can
                choose between submitting a log or modifying personnel info. </p><br>
              <ol style="text-align: left; margin-left: 40px;">
                <li>
                  <p>Submitting a log is used to perform various tasks on the roster, most of these operations are done
                    automatically. For example: if you submit a rank change, the person will automatically be moved on the
                    roster and their document access will be updated. This can take a few seconds to process.</p><br>
                </li>
                <li>
                  <p>Modifying personnel info is only used to edit specific information about a certain member, such as
                    their name or discord ID. This can be handy when for example somebody decides to switch to a new
                    discord account, you can then edit their discord ID to match the new account.</p>
                </li>
              </ol><br><br>
              <p class="left-text">Once you have selected one of these two options, a form will be displayed. Fill out all
                the questions correctly and <strong>double check your answers before submitting</strong> as they cannot be changed
                later. If you are 100% sure that your answers are correct, press submit and be patient while the request
                is being processed. This can take up to 40 seconds to complete so don't panic if
                your change isn't immediately visible. Never "try again" and submit a second time, this will only break
                things. If your change has failed to show up after two minutes just contact a member of Staff Administration through a discord ticket. They will investigate the issue.<br>
                This is about all the information that you need to know in order to properly operate this UI and the staff
                roster.</p><br>
              <h2>Want to know more?</h2><br>
              <p class="left-text">Below you can find all sorts of video & text tutorials that I used, that will get you
                started on understanding how this UI functions and, hopefully, also teach you how to do it
                yourself.<br><br>
                <i class='bx bxs-tag-alt'></i> <a
                  href="https://youtube.com/playlist?list=PLv9Pf9aNgemt82hBENyneRyHnD-zORB3l&si=2WfgL0itSXsRhUQe"
                  target="_blank" class="visible-link">Full course on Google Web Applications</a> -- This tutorial is
                quite old, but so is google apps script. So apart from the old editor layout you will see in this course,
                the language & features are still the same.<br>
                <i class='bx bxs-tag-alt'></i> <a href="https://www.w3schools.com/html/default.asp" target="_blank"
                  class="visible-link">HTML (CSS & JS) documentation</a> -- W3schools is one of the best online sources
                for web development and I cannot recommend it more. For Google Web Apps, you"ll really only need to go
                over the HTML, CSS and Javascript tutorials but there is so much more to find there.<br>
                <i class='bx bxs-tag-alt'></i> <a href="https://boxicons.com/" target="_blank"
                  class="visible-link">Boxicons Library</a> -- Boxicons is a free library full of amazing icons for
                websites. All the icons on this web application come from there, imported as a font. There are many more
                icon libraries out there, and they're all good, but I found boxicons to be the easiest to use.<br>
                <i class='bx bxs-tag-alt'></i> <a href="https://developers.google.com/apps-script/reference"
                  target="_blank" class="visible-link">Apps Script Reference</a> -- This is the official documentation on
                Google Apps Script by Google. Everything you will need to know about this language can be found here.<br>
                <i class='bx bxs-tag-alt'></i> <a href="https://github.com/google/clasp" target="_blank"
                  class="visible-link">Clasp</a> -- Clasp is a software that will let you write Google Apps Script code
                inside of your favorite IDE/Text Editor, instead of having to use the default browser editor. This does
                require you to install NodeJS.<br>
                <i class='bx bxs-tag-alt'></i> <a href="https://chatgpt.com/" target="_blank" class="visible-link">AI
                  (such as ChatGPT)</a> -- AI is, whether you want to accept it or not, a very useful tool for developers
                to assist you. There is nothing wrong with asking ChatGPT for help. ALTHOUGH, I do not recommend asking AI
                to just write the code for you, this won't help you in any way and just make you a worse programmer. Use
                it as a tool, not a goal.
              </p>
              </p>
            </div>
          </div>
          <div class="box-container">
            <div>
              <h2>Your Information</h2><br>
              <h3><strong>Name: </strong>
                <?= data.name; ?>
              </h3><br>
              <h3><strong>Steam ID: </strong>
                <?= data.steamId; ?>
              </h3><br>
              <h3><strong>Discord ID: </strong>
                <?= data.discordId; ?>
              </h3><br>
              <h3><strong>Rank: </strong>
                <?= data.rank; ?>
              </h3><br>
              <h3><strong>Status: </strong>
                <?= data.status; ?>
              </h3><br>
              <h3><strong>Notes: </strong>
                <?= data.notes; ?>
              </h3><br>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Panel -->
    <script>
      // Functions to populate outputDiv with result data
      function UpdateDiv(event) {
        event.preventDefault();
        const inputValue = document.getElementById('inputField').value;
        if (inputValue === "" || !inputValue.includes("STEAM_")) {
          Shake();
          return;
        }

        document.getElementById("loading-search").innerText = "Searching for matching data...";
        document.getElementById("searchLoading").setAttribute("style", "display: block;")

        google.script.run
          .withSuccessHandler(DisplayData)
          .withFailureHandler(error => {
            console.error("Server error:", error); // Log server-side errors
            
            document.getElementById("loading-search").innerText = "An error occured when trying to fetch the data: " + error;
            document.getElementById("searchLoading").setAttribute("style", "display: none;");
          })
          .GetSpreadsheetData(inputValue);
      }

      function DisplayData(data) {
        data = JSON.parse(data);

        const outputDiv = document.getElementById('outputDiv');
        outputDiv.innerHTML = '';

        if (!data || data.length === 0) {
          document.getElementById("loading-search").innerText = "No matching data was found, please try another steam ID.";
          document.getElementById("searchLoading").setAttribute("style", "display: none;");
          return;
        }

        // Format dates to be readable => made using AI (I couldn't be asked)
        function FormatDate(dateString) {
          const date = new Date(dateString);
          if (isNaN(date)) return dateString; // Return original string if not a valid date
          const day = String(date.getDate()).padStart(2, '0');
          const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
          const year = date.getFullYear();
          return `${day}/${month}/${year}`;
        }

        const cardContainer = document.createElement('div');
        cardContainer.style.display = "flex";
        cardContainer.style.flexWrap = "wrap";
        cardContainer.style.justifyContent = "center";
        cardContainer.style.gap = "15px";
        cardContainer.style.backgroundColor = "#777777";
        cardContainer.style.marginTop = "20px";
        cardContainer.style.padding = "20px";
        cardContainer.style.borderRadius = "10px";

        data.forEach(item => {
          const card = document.createElement('div');
          card.style.border = "4px solid black";
          card.style.borderRadius = "10px";
          card.style.padding = "20px";
          card.style.backgroundColor = "#444444";
          card.style.boxShadow = "0 4px 8px black";
          card.style.flex = "1 1 calc(33% - 30px)";
          card.style.maxWidth = "calc(33% - 30px)";
          card.style.boxSizing = "border-box";
          card.style.lineHeight = "1.8";

          const head = document.createElement('div');
          head.textContent = item.sheetLabel;
          head.style.fontSize = "20px";
          head.style.fontWeight = "bold";
          head.style.color = "whitesmoke";
          head.style.fontFamily = "Lexend";
          head.style.paddingBottom = "5px";
          card.appendChild(head);

          Object.entries(item).forEach(([key, value]) => {
            if (key === "sheetLabel") return;

            const field = document.createElement('div');
            field.style.fontSize = "16px";
            field.style.fontWeight = "bold";

            if (key.toLowerCase().includes("date")) {
              value = FormatDate(value);
            }

            // Style color for easy reading
            switch (value) {
              case "Promotion":
                field.style.color = "#34a853";
                break;
              case "Demotion":
                field.style.color = "#ff2f2f";
                break;
              case "Removal":
                field.style.color = "#ff2f2f";
                break;
              case "Severe":
                field.style.color = "#ff2f2f";
                break;
              case "Transfer":
                field.style.color = "#8e7cc3";
                break;
              case "Passed Interview":
                field.style.color = "#3c78d8";
                break;
              default:
                field.style.color = "whitesmoke";
                break;
            }

            // Differentiate logger information
            if (key.includes("Logger")) {
              field.style.color = "gray";
            }

            field.style.fontFamily = "Lexend";
            field.textContent = `${key}: ${value !== null ? value : 'N/A'}`;
            card.appendChild(field);
          });

          cardContainer.appendChild(card);
        });

        outputDiv.appendChild(cardContainer);
        document.getElementById("loading-search").innerText = "";
        document.getElementById("searchLoading").setAttribute("style", "display: none;")
      }
    </script>
    <div class="main-content" id="search_panel" style="display: none;">
      <div class="container">
        <div class="textbox">
          <h1>Search Panel</h1><br>
          <p>Input a Steam ID and you will be shown all logs related to the SteamID.</p><br>
          <form>
            <label for="inputField">Enter SteamID:</label><br>
            <input type="text" id="inputField" maxlength="25" required />
            <button type="submit" class="submitButton-mini" onclick="UpdateDiv(event)">Submit</button>
          </form>
          <p id="loading-search"></p><br>
          <div class="loader" id="searchLoading"></div>
          <div id="outputDiv">
            <!-- Search output goes here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Config Panel -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {

        try {
          google.script.run.withSuccessHandler(response => {
            try { document.getElementById("backupTime").innerText = `Last Backup made ${response} minutes ago`; } catch(e) {}
            // Make sure everything has the time to load
            setTimeout(() => {
              document.getElementById('config-textbox').style.display = "block"; // This one appears to be the slowest
              document.getElementById('config-loading').innerHTML = '';
            }, 1000);
          }).GetLastBackupTime();

          SetSliders();
          SetRankSelects();
        } catch (e) {  }

        document.getElementById('manualEditingSlider').addEventListener('change', function () {
          document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';
          google.script.run.withSuccessHandler(() => {
            document.getElementById('config-loading').innerHTML = '';
          }).ToggleManualEditing(this.checked);
        });

        document.getElementById('pingSlider').addEventListener('change', function () {
          document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';
          google.script.run.withSuccessHandler(() => {
            document.getElementById('config-loading').innerHTML = '';
          }).TogglePings(this.checked);
        });

        try {
          document.getElementById('backupSlider').addEventListener('change', function () {
            document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';
            google.script.run.withSuccessHandler(() => {
              document.getElementById('config-loading').innerHTML = '';
            }).ToggleBackup(this.checked);
          });
        } catch(e) {}

        window.LockdownInit = function (event) {
          event.preventDefault();
          document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';
          const button = document.getElementById('lockdownButton');
          button.disabled = true;

          google.script.run.withSuccessHandler(response => {

            google.script.run.withSuccessHandler(() => {
              document.getElementById('config-loading').innerHTML = '';
              button.disabled = false;
              if (response === "false") {
                document.getElementById('lockdown-topbanner').style.display = "block";
                document.getElementById('lockdownIdentifier').innerText = "Disable";
              } else {
                document.getElementById('lockdown-topbanner').style.display = "none";
                document.getElementById('lockdownIdentifier').innerText = "Enable";
              }
              google.script.run.withSuccessHandler((response) => {
                document.getElementById('backupSlider').checked = (response === "true");
              }).ReturnBackup();
            }).withFailureHandler((error) => {
              document.getElementById('config-loading').innerHTML = '';
              
              button.disabled = false;
            }).ToggleLockdown(response === "true" ? false : true);

          }).withFailureHandler((error) => {
            document.getElementById('config-loading').innerHTML = '';
            
            button.disabled = false;
          }).ReturnLockdown();
        };

        window.AddRankRow = function (event) {
          event.preventDefault();
          let rankElement = document.getElementById('new-rank-select');
          const rank = rankElement.value;
          let rowAmount = document.getElementById("rankRowAmount").value;
          rowAmount = Number(rowAmount);

          if (!rank) return Shake();
          if (!rowAmount || rowAmount <= 0 || rowAmount > 15) {
            Shake();
            if (rowAmount) alert("You must select a number of rows to add between 1 and 15");
            return;
          }

          const buttonAdd = document.getElementById('addrankrow-button');
          const buttonRemove = document.getElementById('removerankrow-button');
          let configLoading = document.getElementById('config-loading');

          configLoading.innerHTML = '<div class="loader"></div>';
          buttonAdd.disabled = true;
          buttonRemove.disabled = true;
          rankElement.disabled = true;

          google.script.run.withSuccessHandler(response => {
            configLoading.innerHTML = '';
            buttonAdd.classList.add('green');
            buttonRemove.classList.add('green');
            setTimeout(() => {
              buttonAdd.classList.remove('green');
              buttonRemove.classList.remove('green');
              buttonAdd.disabled = false;
              buttonRemove.disabled = false;
              rankElement.disabled = false;
            }, 3000);
          }).withFailureHandler((error) => {
            
            Shake();
            configLoading.innerHTML = '';
            configLoading.innerText = "Something went wrong while adding a rank slot";
            buttonAdd.classList.add('red');
            buttonRemove.classList.add('red');
            setTimeout(() => {
              configLoading.innerText = ""
              buttonAdd.disabled = false;
              buttonRemove.disabled = false;
              rankElement.disabled = false;
              buttonAdd.classList.remove('red');
              buttonRemove.classList.remove('red');
            }, 3000);
          }).AddRankRow(rank, rowAmount);
        };

        window.RemoveRankRow = function (event) {
          event.preventDefault();
          const rankElement = document.getElementById('new-rank-select');
          const rank = rankElement.value;
          let rowAmount = document.getElementById("rankRowAmount").value;
          rowAmount = Number(rowAmount);

          if (!rowAmount || rowAmount <= 0) {
            Shake();
            return;
          }

          const buttonAdd = document.getElementById('addrankrow-button');
          const buttonRemove = document.getElementById('removerankrow-button');
          let configLoading = document.getElementById('config-loading');

          configLoading.innerHTML = '<div class="loader"></div>';
          buttonAdd.disabled = true;
          buttonRemove.disabled = true;
          rankElement.disabled = true;

          if (!rank) {
            Shake();
            configLoading.innerHTML = '';
            buttonAdd.disabled = false;
            buttonRemove.disabled = false;
            rankElement.disabled = false;
            return;
          }

          google.script.run.withSuccessHandler(response => {
            configLoading.innerHTML = '';
            if (response) {
              buttonAdd.classList.add('red');
              buttonRemove.classList.add('red');
              Shake();
              setTimeout(() => {
                buttonAdd.classList.remove('red');
                buttonRemove.classList.remove('red');
                buttonAdd.disabled = false;
                buttonRemove.disabled = false;
                rankElement.disabled = false;
              }, 3000);
            } else {
              buttonAdd.classList.add('green');
              buttonRemove.classList.add('green');
              setTimeout(() => {
                buttonAdd.classList.remove('green');
                buttonRemove.classList.remove('green');
                buttonAdd.disabled = false;
                buttonRemove.disabled = false;
                rankElement.disabled = false;
              }, 3000);
            }
          }).withFailureHandler(error => {
            
            Shake();
            configLoading.innerHTML = '';
            configLoading.innerText = "Something went wrong while adding a rank slot";
            buttonAdd.classList.add('red');
            buttonRemove.classList.add('red');
            setTimeout(() => {
              configLoading.innerText = ""
              buttonAdd.disabled = false;
              buttonRemove.disabled = false;
              rankElement.disabled = false;
              buttonAdd.classList.remove('red');
              buttonRemove.classList.remove('red');
            }, 3000);
          }).RemoveRankRow(rank, rowAmount);
        };

        window.RestoreBackup = function (event) {
          event.preventDefault();
          try {
            const button = document.getElementById('restoreBackupButton');
            document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';
            button.disabled = true;

            google.script.run.withSuccessHandler(response => {
              document.getElementById('config-loading').innerHTML = '';
              if (response) {
                button.classList.add("red");
                setTimeout(() => {
                  button.classList.remove("red");
                  button.disabled = false;
                }, 2000);
              } else {
                button.disabled = false;
              }
            }).withFailureHandler(error => {
              
              document.getElementById('config-loading').innerHTML = '';
              button.disabled = false;
              button.classList.add("red");
              setTimeout(() => button.classList.remove("red"), 2000);
            }).RestoreSheet();
          } catch(e) {
            document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';
            document.getElementById('restoreBackupButton').disabled = true;
          }
        };

        window.MakeBackup = function (event) {
          event.preventDefault();
          try {
            const button = document.getElementById('backupButton');
            document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';
            button.disabled = true;

            google.script.run.withSuccessHandler(response => {
              document.getElementById('config-loading').innerHTML = '';
              if (response) {
                button.classList.add("red");
                setTimeout(() => {
                  button.classList.remove("red");
                  button.disabled = false;
                }, 2000);
              } else {
                button.disabled = false;
              }

              // Update last backup time
              google.script.run.withSuccessHandler(response => {
                document.getElementById("backupTime").innerText = `Last Backup made ${response} minutes ago`;
              }).GetLastBackupTime();
            }).withFailureHandler(error => {
              
              document.getElementById('config-loading').innerHTML = '';
              button.disabled = false;
              button.classList.add("red");
              setTimeout(() => button.classList.remove("red"), 2000);
            }).BackupSheet();
          } catch(e) {
            document.getElementById('config-loading').innerHTML = '';
            document.getElementById('backupButton').disabled = false;
          }
        };

        window.RefreshBackupTime = function (event) {
          event.preventDefault();
          try {
            document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';
            google.script.run.withSuccessHandler(response => {
              document.getElementById("backupTime").innerText = `Last Backup made ${response} minutes ago`;
              document.getElementById('config-loading').innerHTML = '';
            }).GetLastBackupTime();
          } catch(e) { 
            document.getElementById('config-loading').innerHTML = '';
          }
        }

        window.ResetPerms = function (event) {
          event.preventDefault();
          const button = document.getElementById('resetButton');
          button.disabled = true;
          document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';

          google.script.run.withSuccessHandler(() => {
            button.disabled = false;
            document.getElementById('config-loading').innerHTML = '';
          }).withFailureHandler(error => {
            
            button.disabled = false;
            document.getElementById('config-loading').innerHTML = '';
          }).ResetPermissions();
        }

        window.SaveAdminRanks = function () {
          event.preventDefault();
          const button = document.getElementById('AdminRankButton');
          button.disabled = true;
          let accessRank = document.getElementById("amdin-role-select").value;
          let rank = document.getElementById("rank").innerText;
          let ranks = document.getElementById("ranks")?.innerText;
          ranks = ranks.split(",");

          if (!accessRank) {
            Shake();
            button.disabled = false;
            return;
          }

          if ((ranks.indexOf(accessRank) >= ranks.indexOf(rank)) && !rank.includes("Blackshadow Staff")) {
            Shake();
            button.disabled = false;
            console.log("You cannot manage rank access above your own rank");
            return;
          }

          google.script.run.withSuccessHandler((updatedarray) => {
            if (!updatedarray) {
              button.classList.add("red");
              button.innerText = "No Permissions";
              setTimeout(() => {
                button.classList.remove("red");
                button.innerText = "Add/Remove";
                button.disabled = false;
                document.getElementById("config-form-adminRanks").reset();
              }, 2000);
            } else {
              InsertRanks(updatedarray);
            }
          }).withFailureHandler(error => {
            
            button.disabled = false;
          }).UpdateAccess(accessRank, rank);
        };

        window.InsertRanks = function (ranks) {
          const button = document.getElementById('AdminRankButton');
          ranks = JSON.parse(ranks);
          document.getElementById("allowedRanks").innerText = ranks;
          button.disabled = false;
          document.getElementById("config-form-adminRanks").reset();
        };

        window.SubmitChangelog = function(event) {
          event.preventDefault();
          let changelog = document.getElementById("changes").value;
          const button = document.getElementById("changelogButton");

          if (changelog.length < 20) {
            Shake();
            return;
          }

          button.disabled = true;
          google.script.run.withSuccessHandler(() => {
            button.disabled = false;
            document.getElementById("changelog-form").reset();
          }).withFailureHandler(() => {
            button.disabled = false;
          }).SubmitChange(changelog);
        };

        let coll = document.getElementById("manageRank");

        coll.addEventListener("click", function() {
          this.classList.toggle("active");
          var content = document.getElementById("newRankContent");
          if (content.style.display === "block") {
            content.style.display = "none";
          } else {
            content.style.display = "block";
          }
        });

        let coll2 = document.getElementById("manageSpecialization");

        coll2.addEventListener("click", function() {
          this.classList.toggle("active");
          var content = document.getElementById("manageSpecContent");
          if (content.style.display === "block") {
            content.style.display = "none";
          } else {
            content.style.display = "block";
          }
        });

        window.AddNewRank = function(event) {
          event.preventDefault();
          let button = document.getElementById("newrank-button");
          const hierarchySelect = document.getElementById("new-rank-before-select");

          let data = {
            title: document.getElementById("newRankTitle").value,
            rankBefore: hierarchySelect.value,
            viewerFolders: document.getElementById("newRankViewFolders").value,
            editorFolders: document.getElementById("newRankEditFolders").value,
            editRank: document.getElementById("editRankSelect").value
          }

          if (!data.title || !data.rankBefore) return Shake();

          if (hierarchySelect.value == document.getElementById("editRankSelect").value) {
            hierarchySelect.value = "";
            button.disabled = true;
            Shake();
            button.classList.add("red");
            button.innerText = "Cannot place a rank before itself"; //
            return setTimeout(() => {
              button.innerText = "Edit Existing Rank";
              button.classList.remove("red");
              button.disabled = false;
            }, 3000);
          }

          let valid = true;
          Object.values(data).forEach(value => {
            if (value && (value.includes('"') || value.includes("'") || value.includes("`") || value.includes("$") || value.includes("{"))) {
              valid = false;
            }
          });

          if (!valid) {
            Shake();
            button.innerText = "No special characters allowed in input values";
            button.disabled = true;
            setTimeout(() => {
              button.innerText = "Submit New Rank";
              button.disabled = false;
            }, 2000);
            return;
          }

          button.disabled = true;
          button.innerHTML = '<div class="loader"></div>';

          google.script.run.withSuccessHandler((response) => {
            if (
              response.toLowerCase().includes("not") 
              || response.toLowerCase().includes("already") 
              || response.toLowerCase().includes("invalid")
              || response.toLowerCase().includes("unrelated")
            ) {
              Shake();
              button.classList.add('red');
            } else {
              button.classList.add('green');
              document.getElementById("newrankForm").reset();
            }

            button.innerHTML = "";
            button.innerText = response;
            setTimeout(() => {
              button.innerText = "Submit New Rank";
              button.disabled = false;
              button.classList.remove('red');
              button.classList.remove('green');
            }, 3000);

            google.script.run.withSuccessHandler(ranks => {
              ranks = JSON.parse(ranks);
              document.getElementById("ranks").innerText = ranks;
              SetRankSelects();
            }).GetRanks();

          }).withFailureHandler(error => {
            

            // Manipulating button text to give info to user.
            button.innerHTML = "";
            button.innerText = "Something went wrong";
            setTimeout(() => {
              button.innerText = "Submit New Rank";
              button.disabled = false;
            }, 4000);
          }).AddNewRank(data);
        };

        window.RemoveRank = function(event) {
          event.preventDefault();
          const button = document.getElementById("removeRank-button");
          const rank = document.getElementById("remove-rank-select").value;

          if (!rank) return Shake();

          const proceed = confirm(`You are about to remove the rank of ${rank} from the roster. Press OK if you would like to continue this action.`);

          if (proceed == true) {
            button.disabled = true;
            document.getElementById('config-loading').innerHTML = '<div class="loader" style="width: 10px; height: 10px;"></div>';

            google.script.run.withSuccessHandler(response => {
              if (response.toLowerCase().includes("not") || response.toLowerCase().includes("already")) {
                Shake();
                button.classList.add('red');
              } else {
                button.classList.add('green');
                document.getElementById("newrankForm").reset();
              }

              button.innerText = response;
              setTimeout(() => {
                button.innerText = "Delete";
                document.getElementById('config-loading').innerHTML = "";
                button.disabled = false;
                button.classList.remove('red');
                button.classList.remove('green');
              }, 3000);

              google.script.run.withSuccessHandler(ranks => {
                ranks = JSON.parse(ranks);
                document.getElementById("ranks").innerText = ranks;
                SetRankSelects();
              }).GetRanks();
            }).withFailureHandler(error => {
              
              button.disabled = false;
              button.innerText = "Delete";
              document.getElementById('config-loading').innerHTML = "";
            }).RemoveRank(rank);
          }
        };

        window.AddNewSpec = function(event) {
          event.preventDefault();
          const title = document.getElementById("specTitle").value;
          const desc = document.getElementById("specDesc").value;
          const editExisting = document.getElementById("editSpecSelect").value;
          const button = document.getElementById("spec-button");

          if (!title || !desc) return Shake();
          if (title.length > 20 || desc.length > 250) return Shake();

          button.disabled = true;
          button.innerHTML = '<div class="loader"></div>';

          google.script.run.withSuccessHandler(response => {
            button.innerHTML = "";
            if (response.toLowerCase().includes("not")) {
              Shake();
              button.classList.add('red');
            } else {
              button.classList.add('green');
              document.getElementById("spec-form").reset();
            }

            button.innerText = response;
            setTimeout(() => {
              button.innerText = `${editExisting == "" ? "Submit New" : "Edit Existing"} Specialization`;
              button.disabled = false;
              button.classList.remove('red');
              button.classList.remove('green');
            }, 3000);

            SetSpecSelects();
          }).withFailureHandler(error => {
            
            button.innerHTML = "";
            button.innerText = "Something went wrong";
            setTimeout(() => {
              button.innerText = `${editExisting == "" ? "Submit New" : "Edit Existing"} Specialization`;
              button.disabled = false;
            }, 3000);
          }).AddSpec(title, desc, editExisting);
        };

        window.RemoveExistingSpec = function(event) {
          event.preventDefault();
          const title = document.getElementById("removeSpec").value;
          const button = document.getElementById("removespec-button");

          if (!title) return Shake();

          button.disabled = true;

          google.script.run.withSuccessHandler(response => {
            if (response.includes("not")) {
              Shake();
              button.classList.add('red');
            } else {
              button.classList.add('green');
              document.getElementById("removespec-form").reset();
            }

            setTimeout(() => {
              button.disabled = false;
              button.classList.remove('red');
              button.classList.remove('green');
            }, 1000);

            SetSpecSelects();
          }).withFailureHandler(error => {
            console.log(error);
            button.disabled = false;
          }).RemoveSpec(title);
        };

        window.FillSpec = function(event) {
          event.preventDefault();
          const select = document.getElementById("editSpecSelect");
          const titleField = document.getElementById("specTitle");
          const descField = document.getElementById("specDesc");
          const button = document.getElementById("spec-button");

          if (select.value == "") {
            titleField.value = "";
            descField.value = "";
            button.disabled = false;
            select.disabled = false;
            return button.innerText = "Submit New Specialization";
          }

          button.disabled = true;
          select.disabled = true;
          button.innerHTML = '<div class="loader"></div>';

          google.script.run.withSuccessHandler(content => {
            content = JSON.parse(content);
            if (content.length !== 2) {
              button.innerText = "Rank not found";
              button.classList.add("red");
              setTimeout(() => {
                button.disabled = false;
                select.disabled = false;
                button.innerText = "Edit Existing Specialization";
                return;
              }, 3000); 
            }

            titleField.value = content[0];
            descField.value = content[1];

            button.disabled = false;
            select.disabled = false;
            button.innerHTML = '';
            button.innerText = "Edit Existing Specialization";
          }).withFailureHandler(() => {
            button.innerHTML = "";
            button.innerText = "Something went wrong";
            setTimeout(() => {
              button.innerText = "Submit New Specialization";
              button.disabled = false;
              select.disabled = false;
            }, 3000);
          }).GetSpecContent(select.value);
        };

        window.FillRank = function(event) {
          event.preventDefault();

          const select = document.getElementById("editRankSelect");
          const titleInput = document.getElementById("newRankTitle");
          const hierarchySelect = document.getElementById("new-rank-before-select");
          const viewFoldersInput = document.getElementById("newRankViewFolders");
          const editFoldersInput = document.getElementById("newRankEditFolders");
          const button = document.getElementById("newrank-button");
          const form = document.getElementById("newrankForm");

          if (select.value == "") {
            form.reset();
            button.disabled = false;
            return button.innerText = "Submit New Rank";
          }

          button.disabled = true;
          select.disabled = true;
          button.innerHTML = '<div class="loader"></div>';

          google.script.run.withSuccessHandler(content => {
            content = JSON.parse(content);
            if (content.length !== 4) {
              button.innerText = "Rank not found";
              button.classList.add("red");
              setTimeout(() => {
                form.reset();
                button.disabled = false;
                select.disabled = false;
                button.innerText = "Edit Existing Rank";
                return;
              }, 3000); 
            }

            titleInput.value = content[0];
            hierarchySelect.value = content[1];
            viewFoldersInput.value = content[2];
            editFoldersInput.value = content[3];

            button.disabled = false;
            select.disabled = false;
            button.innerHTML = "";
            button.innerText = "Edit Existing Rank";
          }).withFailureHandler(error => {
            button.innerText = "something went wrong";
            button.classList.add("red");
            setTimeout(() => {
              form.reset();
              button.disabled = false;
              select.dsiabled = false;
              button.classList.remove("red");
              select.value = "";
              button.innerText = "Submit New Rank";
            }, 3000);
          }).GetRankContent(select.value);
        };

      });
    </script>
    <div class="main-content" id="config" style="display: none;">
      <div class="container">
        <div class="textbox" id="config-textbox" style="display: none;">
          <h1>Config Panel</h1><br>
          <p>Configure all sorts of aspects of the <?= factionName ?> Roster here!<br>When changing something in this menu, wait for
            the loading animation at the bottom of the page to stop before performing another operation.</p>
          <br>
          <hr><br>

          <form id="config-form-adminRanks">
            <label for="amdin-role-select"><strong>Select Rank to add/remove access to the Admin Menu</strong> <br>(if the rank already had access, they will be removed. If they didn't, they will be added.)<br>Current allowed ranks: <span id="allowedRanks"><?= adminRanks ?></span>
            </label><br>
            <select id="amdin-role-select">
            </select>
            <button id="AdminRankButton" onclick="SaveAdminRanks(event)" type="submit" class="submitButton-mini">Add/Remove</button>
          </form><br>

          <? if (allowedStaff.includes(user)) { ?>
          <form id="changelog-form">
            <label for="changes"><strong>Add the change notes, seperated by a comma:</strong></label><br>
            <input type="message" id="changes" placeholder="Add your changes, seperated by a comma" minlength="20" required></input>
            <button id="changelogButton" onclick="SubmitChangelog(event)" type="submit" class="submitButton-mini">Submit</button>
          </form><br>
          <? } ?>

          <button id="manageRank" class="submitButton">Manage Ranks</button>
          <div id="newRankContent" class="container">
            <form id="newrankForm">
              <label for="editRankSelect">Select if you want to edit an exsiting rank:</label><br>
              <select id="editRankSelect" onchange="FillRank(event)">
              </select><br>
              <label for="newRankTitle">Add a title to your rank:</label><br>
              <input id="newRankTitle" type="text" placeholder="Add rank Title" required><br>
              <label for="new-rank-before-select">Add your rank before this rank in the hierarchy:</label><br>
              <select id="new-rank-before-select" required>
              </select><br>
              <label for="newRankViewFolders">Add the IDs of the folders that this rank should have viewer access to:<br><span style="font-size: 13px; font-weight: 100;">Seperate the IDs with a comma, <?= factionName ?> related folders ONLY</span></label><br>
              <input type="text" id="newRankViewFolders" placeholder="Add the folders seperated by a comma"><br>
              <label for="newRankEditFolders">Add the IDs of the folders that this rank should have editor access to:<br><span style="font-size: 13px; font-weight: 100;">Seperate the IDs with a comma, <?= factionName ?> related folders ONLY</span></label><br>
              <input type="text" id="newRankEditFolders" placeholder="Add the folders seperated by a comma"><br>
              <button onclick="AddNewRank(event)" class="submitButton" id="newrank-button" type="submit">Submit New Rank</button>
            </form><br><hr><br>

            <form id="config-form-removeRank">
              <label for="remove-rank-select"><strong>Select a rank to delete from the roster:</strong></label><br>
              <select id="remove-rank-select" style="width: 50%;">
              </select>
              <button onclick="RemoveRank(event)" class="submitButton-mini" id="removeRank-button">Delete</button>
            </form><br><hr><br>

            <form id="config-form-rankRow">
              <label for="new-rank-select"><strong>Select a rank to add/remove a slot to/from.</strong></label><br>
              <select id="new-rank-select" style="width: 42%;">
              </select>
              <input type="number" id="rankRowAmount" style="width: 8%;" placeholder="#">
              <button onclick="AddRankRow(event)" class="submitButton-mini-mini" id="addrankrow-button">Add</button>
              <button onclick="RemoveRankRow(event)" type="submit" class="submitButton-mini-mini" id="removerankrow-button">Remove</button>
            </form><br>
          </div><br><br>

          <button id="manageSpecialization" class="submitButton">Manage Specializations</button>
          <div id="manageSpecContent" class="container">
            <form id="spec-form">
              <label for="editSpecSelect">Select if you want to edit an existing specialization:</label><br>
              <select id="editSpecSelect" onchange="FillSpec(event)">
              </select><br>
              <label for="specTitle">Give your specialization a name:</label><br>
              <input type="text" id="specTitle" placeholder="Add a name to your specialization" maxlength="20" required><br>
              <label for="specDesc">Give your specialization a description:</label><br>
              <input type="text" id="specDesc" placeholder="Add a description to your specialization" maxlength="250" required>
              <button onclick="AddNewSpec(event)" class="submitButton" id="spec-button" type="submit">Submit New Specialization</button>
            </form><br><hr><br>
            <form id="removespec-form">
              <label for="removeSpec">Select a specialization to remove:</label><br>
              <select id="removeSpec" style="width: 50%">
              </select>
              <button onclick="RemoveExistingSpec(event)" class="submitButton-mini" id="removespec-button" type="submit">Remove</button>
            </form>
          </div>

          <table class="config-switches" style="margin-top: 30px;">
              <td>
                Enable Manual Editing of the roster:
              </td>
              <td class="config-switch">
                <label class="switch">
                  <input type="checkbox" id="manualEditingSlider">
                  <span class="slider round"></span>
                </label>
              </td>
            </tr>
            <tr>
              <td>
                Enable time-based (12h) Backups being made of the roster:
              </td>
              <td class="config-switch">
                <label class="switch">
                  <input type="checkbox" id="backupSlider">
                  <span class="slider round"></span>
                </label>
              </td>
            </tr>
            <tr>
              <td>
                Allow discord pings:<br><span style="font-weight: 200; font-size: 12px;">Enable/Disable people being pinged for things like promotions etc...</span>
              </td>
              <td class="config-switch">
                <label class="switch">
                  <input type="checkbox" id="pingSlider">
                  <span class="slider round"></span>
                </label>
              </td>
            </tr>

            <? if (allowedStaff.includes(user)) { ?>
            <tr>
              <td>
                Make a roster backup immediately:
              </td>
              <td class="config-switch">
                <button class="submitButton-mini-mini" id="backupButton" onclick="MakeBackup(event)">Backup</button>
              </td>
            </tr>
            <tr>
              <td>
                Restore the roster to its latest backup:<br><span id="backupTime" style="font-weight: 200; font-size: 12px;" onclick="RefreshBackupTime(event)"></span>
              </td>
              <td class="config-switch">
                <button class="submitButton-mini-mini" id="restoreBackupButton" onclick="RestoreBackup(event)">Restore</button>
              </td>
            </tr>
            <? } ?>
            
            <tr>
              <td>
                Reset all <?= factionName ?> Documentation Permissions:<br><span style="font-weight: 200; font-size: 12px;">All perms will be removed & re-added for a quick emergency reset.</span>
              </td>
              <td class="config-switch">
                <button class="submitButton-mini-mini" id="resetButton" onclick="ResetPerms(event)">Reset</button>
              </td>
            </tr>
            <tr>
              <td>
                <span id="lockdownIdentifier"></span> a full Lockdown of all <?= factionName ?> Documentation:
              </td>
              <td class="config-switch">
                <button class="submitButton-mini-mini" id="lockdownButton" onclick="LockdownInit(event)">Lockdown</button>
              </td>
            </tr>
          </table>
        </div>
        <p id="config-loading" style="margin-top: 15px;"></p>
        <p style="font-size: 0px;" id="ranks"><?= ranks ?></p>
        <p style="font-size: 0px;" id="rank"><?= data.rank ?></p>
      </div>
    </div>
    <script>
      // Needs to be below config loading element so the <p> is loaded
      document.getElementById('config-loading').innerHTML = '<div class="loader"></div>';
      document.getElementById("newRankContent").classList.add("collapseContent");
      document.getElementById("manageRank").classList.add("collapsible");
      document.getElementById("manageSpecContent").classList.add("collapseContent");
      document.getElementById("manageSpecialization").classList.add("collapsible")
    </script>

    <!-- Form Section (both Logger and Edit Form)
      Apologies for the terrible formatting -->
    <script>
      // Toggle which questions are visible depending on main selection
      function HideCheck() {
        // This MASSIVE switch statement is not best practice, but it works :)
        const logtype = document.getElementById('logTypeList').value;
        switch (logtype) {
          case 'Infraction Log':
            document.getElementById('namefield').setAttribute('style', 'display: none;');
            document.getElementById('steamidfield').setAttribute('style', 'display: none;');
            document.getElementById('discordidfield').setAttribute('style', 'display: none;');
            document.getElementById('emailfield').setAttribute('style', 'display: block;');
            document.getElementById('reasonfield').setAttribute('style', 'display: block;');
            document.getElementById('infrtypelist').setAttribute('style', 'display: block;');
            document.getElementById('infrlabel').setAttribute('style', 'display: block;');
            document.getElementById('enddatefield').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelLOA').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelBL').setAttribute('style', 'display: none;');
            document.getElementById('appealable').setAttribute('style', 'display: none;');
            document.getElementById('appealablelabel').setAttribute('style', 'display: none;');
            document.getElementById('rctypefield').setAttribute('style', 'display: none;');
            document.getElementById('rctypelabel').setAttribute('style', 'display: none;');
            document.getElementById('idfield').setAttribute('style', 'display: none;');
            document.getElementById('idfieldlabel').setAttribute('style', 'display: none;');
            document.getElementById('bllabel').setAttribute('style', 'display: none;');
            document.getElementById('bltypelist').setAttribute('style', 'display: none;');
            break;
          case 'Rank Change':
            document.getElementById('namefield').setAttribute('style', 'display: none;');
            document.getElementById('steamidfield').setAttribute('style', 'display: none;');
            document.getElementById('discordidfield').setAttribute('style', 'display: none;');
            document.getElementById('emailfield').setAttribute('style', 'display: block;');
            document.getElementById('reasonfield').setAttribute('style', 'display: block;');
            document.getElementById('infrtypelist').setAttribute('style', 'display: none;');
            document.getElementById('infrlabel').setAttribute('style', 'display: none;');
            document.getElementById('enddatefield').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelLOA').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelBL').setAttribute('style', 'display: none;');
            document.getElementById('appealable').setAttribute('style', 'display: none;');
            document.getElementById('appealablelabel').setAttribute('style', 'display: none;');
            document.getElementById('rctypefield').setAttribute('style', 'display: block;');
            document.getElementById('rctypelabel').setAttribute('style', 'display: block;');
            document.getElementById('idfield').setAttribute('style', 'display: none;');
            document.getElementById('idfieldlabel').setAttribute('style', 'display: none;');
            document.getElementById('bllabel').setAttribute('style', 'display: none;');
            document.getElementById('bltypelist').setAttribute('style', 'display: none;');
            break;
          case 'LOA Log':
            document.getElementById('namefield').setAttribute('style', 'display: none;');
            document.getElementById('steamidfield').setAttribute('style', 'display: none;');
            document.getElementById('discordidfield').setAttribute('style', 'display: none;');
            document.getElementById('emailfield').setAttribute('style', 'display: block;');
            document.getElementById('reasonfield').setAttribute('style', 'display: block;');
            document.getElementById('infrtypelist').setAttribute('style', 'display: none;');
            document.getElementById('infrlabel').setAttribute('style', 'display: none;');
            document.getElementById('enddatefield').setAttribute('style', 'display: block;');
            document.getElementById('enddatelabelLOA').setAttribute('style', 'display: block;');
            document.getElementById('enddatelabelBL').setAttribute('style', 'display: none;');
            document.getElementById('appealable').setAttribute('style', 'display: none;');
            document.getElementById('appealablelabel').setAttribute('style', 'display: none;');
            document.getElementById('rctypefield').setAttribute('style', 'display: none;');
            document.getElementById('rctypelabel').setAttribute('style', 'display: none;');
            document.getElementById('idfield').setAttribute('style', 'display: none;');
            document.getElementById('idfieldlabel').setAttribute('style', 'display: none;');
            document.getElementById('bllabel').setAttribute('style', 'display: none;');
            document.getElementById('bltypelist').setAttribute('style', 'display: none;');
            break;
          case 'Blacklist':
            document.getElementById('namefield').setAttribute('style', 'display: none;');
            document.getElementById('steamidfield').setAttribute('style', 'display: none;');
            document.getElementById('discordidfield').setAttribute('style', 'display: none;');
            document.getElementById('emailfield').setAttribute('style', 'display: none;');
            document.getElementById('reasonfield').setAttribute('style', 'display: none;');
            document.getElementById('infrtypelist').setAttribute('style', 'display: none;');
            document.getElementById('infrlabel').setAttribute('style', 'display: none;');
            document.getElementById('enddatefield').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelLOA').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelBL').setAttribute('style', 'display: none;');
            document.getElementById('appealable').setAttribute('style', 'display: none;');
            document.getElementById('appealablelabel').setAttribute('style', 'display: none;');
            document.getElementById('rctypefield').setAttribute('style', 'display: none;');
            document.getElementById('rctypelabel').setAttribute('style', 'display: none;');
            document.getElementById('idfield').setAttribute('style', 'display: none;');
            document.getElementById('idfieldlabel').setAttribute('style', 'display: none;');
            document.getElementById('bllabel').setAttribute('style', 'display: block;');
            document.getElementById('bltypelist').setAttribute('style', 'display: block;');
            document.getElementById('bltypelist').value = "";
            break;
          case 'Infraction Appeal':
            document.getElementById('namefield').setAttribute('style', 'display: none;');
            document.getElementById('steamidfield').setAttribute('style', 'display: none;');
            document.getElementById('discordidfield').setAttribute('style', 'display: none;');
            document.getElementById('emailfield').setAttribute('style', 'display: none;');
            document.getElementById('reasonfield').setAttribute('style', 'display: block;');
            document.getElementById('infrtypelist').setAttribute('style', 'display: none;');
            document.getElementById('infrlabel').setAttribute('style', 'display: none;');
            document.getElementById('enddatefield').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelLOA').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelBL').setAttribute('style', 'display: none;');
            document.getElementById('appealable').setAttribute('style', 'display: none;');
            document.getElementById('appealablelabel').setAttribute('style', 'display: none;');
            document.getElementById('rctypefield').setAttribute('style', 'display: none;');
            document.getElementById('rctypelabel').setAttribute('style', 'display: none;');
            document.getElementById('idfield').setAttribute('style', 'display: block;');
            document.getElementById('idfieldlabel').setAttribute('style', 'display: block;');
            document.getElementById('bllabel').setAttribute('style', 'display: none;');
            document.getElementById('bltypelist').setAttribute('style', 'display: none;');
            break;
          case 'Blacklist Appeal':
            document.getElementById('namefield').setAttribute('style', 'display: none;');
            document.getElementById('steamidfield').setAttribute('style', 'display: none;');
            document.getElementById('discordidfield').setAttribute('style', 'display: none;');
            document.getElementById('emailfield').setAttribute('style', 'display: none;');
            document.getElementById('reasonfield').setAttribute('style', 'display: block;');
            document.getElementById('infrtypelist').setAttribute('style', 'display: none;');
            document.getElementById('infrlabel').setAttribute('style', 'display: none;');
            document.getElementById('enddatefield').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelLOA').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelBL').setAttribute('style', 'display: none;');
            document.getElementById('appealable').setAttribute('style', 'display: none;');
            document.getElementById('appealablelabel').setAttribute('style', 'display: none;');
            document.getElementById('rctypefield').setAttribute('style', 'display: none;');
            document.getElementById('rctypelabel').setAttribute('style', 'display: none;');
            document.getElementById('idfield').setAttribute('style', 'display: block;');
            document.getElementById('idfieldlabel').setAttribute('style', 'display: block;');
            document.getElementById('bllabel').setAttribute('style', 'display: none;');
            document.getElementById('bltypelist').setAttribute('style', 'display: none;');
            break;
          case 'New Member':
            document.getElementById('namefield').setAttribute('style', 'display: block;');
            document.getElementById('steamidfield').setAttribute('style', 'display: block;');
            document.getElementById('discordidfield').setAttribute('style', 'display: block;');
            document.getElementById('emailfield').setAttribute('style', 'display: block;');
            document.getElementById('reasonfield').setAttribute('style', 'display: block;');
            document.getElementById('infrtypelist').setAttribute('style', 'display: none;');
            document.getElementById('infrlabel').setAttribute('style', 'display: none;');
            document.getElementById('enddatefield').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelLOA').setAttribute('style', 'display: none;');
            document.getElementById('enddatelabelBL').setAttribute('style', 'display: none;');
            document.getElementById('appealable').setAttribute('style', 'display: none;');
            document.getElementById('appealablelabel').setAttribute('style', 'display: none;');
            document.getElementById('rctypefield').setAttribute('style', 'display: none;');
            document.getElementById('rctypelabel').setAttribute('style', 'display: none;');
            document.getElementById('idfield').setAttribute('style', 'display: none;');
            document.getElementById('idfieldlabel').setAttribute('style', 'display: none;');
            document.getElementById('bllabel').setAttribute('style', 'display: none;');
            document.getElementById('bltypelist').setAttribute('style', 'display: none;');
            break;
        }
      }

      // SUBMITING FORMS
      function SubmitLog(event) {
        event.preventDefault();
        console.time("Log Submission Runtime");
        const button = document.getElementById("loggerSubmitButton");
        button.disabled = true;

        // Set some data if a New Member was logged so it can use the same script as Rank Change in the logger engine
        let data_type = document.getElementById('logTypeList').value == "New Member" ? "Rank Change" : document.getElementById('logTypeList').value;
        let data_rankchangetype = document.getElementById('logTypeList').value == "New Member" ? "Passed Interview" : document.getElementById('rctypefield').value;
        let data_type_check = document.getElementById('logTypeList').value == "New Member" ? "New Member" : document.getElementById('logTypeList').value;

        const dataToSubmit = {
          type: data_type,
          type_check: data_type_check,
          name: document.getElementById('namefield').value,
          steamid: document.getElementById('steamidfield').value,
          discordid: document.getElementById('discordidfield').value,
          email: document.getElementById('emailfield').value,
          rankchangetype: data_rankchangetype,
          reason: document.getElementById('reasonfield').value,
          infraction_type: document.getElementById('infrtypelist').value,
          end_date: document.getElementById('enddatefield').value,
          blacklist_appealable: document.getElementById('appealable').value,
          log_id: document.getElementById('idfield').value,
          blacklist_type: document.getElementById('bltypelist').value
        };

        // Data validation -> check if correct data has been inputted
        let valid = false;
        switch (dataToSubmit.type_check) {
          case 'Rank Change':
            if (dataToSubmit.email.includes("@") && dataToSubmit.email.includes(".") && dataToSubmit.reason != '' && dataToSubmit.rankchangetype != '') { valid = true; }
            if (dataToSubmit.rankchangetype == "Transfer") { dataToSubmit.branch != "" ? valid = true : valid = false; }
            break;
          case 'Infraction Log':
            if (dataToSubmit.email.includes("@") && dataToSubmit.email.includes(".") && dataToSubmit.reason != '' && dataToSubmit.infraction_type != '') { valid = true; }
            break;
          case 'LOA Log':
            if (dataToSubmit.email.includes("@") && dataToSubmit.email.includes(".") && dataToSubmit.reason != '' && dataToSubmit.end_date != '') { valid = true; }
            break;
          case 'Blacklist':
            if (dataToSubmit.email.includes("@") && dataToSubmit.email.includes(".") && dataToSubmit.end_date != '' && dataToSubmit.reason != '' && dataToSubmit.blacklist_appealable != '') {
              switch (dataToSubmit.blacklist_type) {
                case "Suspension":
                  valid = true;
                  break;
                case "Blacklist":
                  if (dataToSubmit.name != '' && dataToSubmit.steamid != '' && dataToSubmit.discordid != '' && dataToSubmit.blacklist_type != '') valid = true;
                  break;
              }
            }
            break;
          case 'Infraction Appeal':
            if (dataToSubmit.reason != '' && dataToSubmit.log_id >= 7) valid = true;
            break;
          case 'Blacklist Appeal':
            if (dataToSubmit.log_id >= 7) valid = true;
            break;
          case "New Member":
            if (dataToSubmit.email.includes('.') && dataToSubmit.email.includes('@') && dataToSubmit.steamid.includes("STEAM_") && dataToSubmit.reason != '' && dataToSubmit.branch != '') valid = true;
            break;
          default:
            break;
        }

        Object.values(dataToSubmit).forEach(value => {
          if (value && (value.includes('"') || value.includes("'") || value.includes("`") || value.includes("$") || value.includes("{"))) {
            valid = false;
          }
        });

        if (!valid) {
          Shake();
          button.innerText = "No special characters allowed in input values";
          button.disabled = true;
          setTimeout(() => {
            button.innerText = "Submit New Rank";
            button.disabled = false;
          }, 2000);
          return;
        }

        // Actually submitting data
        if (valid === true) {
          button.innerText = "";
          button.innerHTML = '<div class="loader"></div>';
          google.script.run.withSuccessHandler(response => {

            HideCheck();
            console.log("Log sucessfully submitted");

            if (response.includes("not") || response.includes("capacity") || response.includes("only") || response.includes("must")) {
              Shake();
              button.classList.add('red');
            } else if (!response.includes('something')) {
              document.getElementById('dataform').reset();
              HideCheck();
              button.classList.add('green');
            }

            // Manipulating button text to give info to user.
            button.innerHTML = "";
            button.innerText = response;
            setTimeout(() => {
              button.innerText = "Submit";
              button.disabled = false;
              button.classList.remove('red');
              button.classList.remove('green');
            }, 4000);
            document.getElementById('rctypefield').value = "";
            document.getElementById('bltypelist').value = "";
            console.timeEnd("Log Submission Runtime");

          }).withFailureHandler(error => {
            

            // Manipulating button text to give info to user.
            button.innerHTML = "";
            button.innerText = "Something went wrong";
            setTimeout(() => {
              button.innerText = "Submit";
              button.disabled = false;
            }, 4000);
            console.timeEnd("Log Submission Runtime");

          }).ProcessLog(dataToSubmit);
        } else if (valid == false) {
          // Make screen shake if not all questions were answered (idk seemed fun)
          Shake();
          console.log("You did not fill out all questions correctly -- Submission failed");
          button.disabled = false;
          console.timeEnd("Log Submission Runtime");
        }
      }

      function BlacklistToggle() {
        try {
          const blacklistTypeSelector = document.getElementById('bltypelist');
          if (blacklistTypeSelector.value == "Suspension") {
            document.getElementById('namefield').setAttribute('style', 'display: none;');
            document.getElementById('steamidfield').setAttribute('style', 'display: none;');
            document.getElementById('discordidfield').setAttribute('style', 'display: none;');
            document.getElementById('emailfield').setAttribute('style', 'display: block;');
            document.getElementById('reasonfield').setAttribute('style', 'display: block;');
            document.getElementById('appealablelabel').setAttribute('style', 'display: block;');
            document.getElementById('appealable').setAttribute('style', 'display: block;');
            document.getElementById('enddatefield').setAttribute('style', 'display: block;');
            document.getElementById('enddatelabelBL').setAttribute('style', 'display: block;');
            document.getElementById('appealablelabel').innerText = "Is the Suspension appealable?";
            document.getElementById('enddatelabelBL').innerText = "Select expiry date of Suspension:";
          } else if (blacklistTypeSelector.value == "Blacklist") {
            document.getElementById('namefield').setAttribute('style', 'display: block;');
            document.getElementById('steamidfield').setAttribute('style', 'display: block;');
            document.getElementById('discordidfield').setAttribute('style', 'display: block;');
            document.getElementById('emailfield').setAttribute('style', 'display: block;');
            document.getElementById('reasonfield').setAttribute('style', 'display: block;');
            document.getElementById('appealablelabel').setAttribute('style', 'display: block;');
            document.getElementById('appealable').setAttribute('style', 'display: block;');
            document.getElementById('enddatefield').setAttribute('style', 'display: block;');
            document.getElementById('enddatelabelBL').setAttribute('style', 'display: block;');
            document.getElementById('appealablelabel').innerText = "Is the Blacklist appealable?";
            document.getElementById('enddatelabelBL').innerText = "Select expiry date of Blacklist:";
          }
        } catch (e) {
          console.log("Blacklist Type edited");
        }
      }
    </script>
    <div class="main-content" id="data-forms" style="display: none;">
      <div class="container">
        <div class="textbox">

          <div id="loggerForm" style="display: none;">
            <form id="dataform">
              <h1>Staff Roster Logger Form</h1>
              <p>Please fill out <strong>all</strong> the below questions in order to submit a log.</p>
              <p>Before submitting, double-check your answers as once you press the button, they can no longer be
                adjusted.
              </p>
              <br>
              <hr>
              <br>
              <h3>Main Options</h3>
              <br>
              <p>Please select which type of log you want to submit.</p><br>
              <select id="logTypeList" onchange="HideCheck()">
                <option value="Rank Change">Rank Change</option>
                <option value="New Member">Add New <?= ranks[0] ?></option>
                <option value="Infraction Log">Infraction Log</option>
                <option value="LOA Log">LOA Log</option>
                <option value="Blacklist">Blacklist / Suspension</option>
                <? if (allowedStaff.includes(user)) { ?>
                <option value="Infraction Appeal">Appeal Infraction [SM+]</option>
                <option value="Blacklist Appeal">Appeal Blacklist [SM+]</option>
                <? } ?>
              </select>
              <hr><br>
              <h3>Log Information</h3>
              <br>
              <p>All below questions must contain info related to the log / the person to whom the log is targeted.<br>Do
                not include information about yourself.
              </p><br>
              <label for="idfield" id="idfieldlabel" style="display: none;">The log ID is the row where the log you want
                to appeal is located.</label>
              <input type="number" placeholder="Log ID; minimum 7, up to 1003" id='idfield' min="7" max="1003"
                style="display: none;" required />
              <label for="infrtypelist" id="infrlabel" style="display: none;">Select an Infraction Type:</label>
              <select type="text" id='infrtypelist' style="display: none;" required>
                <option value=''></option>
                <option value="Minor">Minor</option>
                <option value="Regular">Regular</option>
                <option value="Severe">Severe</option>
              </select>
              <label for="bltypelist" id="bllabel" style="display: none;">Do you want to log a Blacklist or
                Suspension?:</label>
              <select type="text" id='bltypelist' style="display: none;" onchange="BlacklistToggle()" required>
                <option value=''></option>
                <option value="Suspension">Suspension</option>
                <option value="Blacklist">Blacklist</option>
              </select>
              <label for='appealable' id='appealablelabel' style="display: none;">Is the Blacklist appealable?:</label>
              <select type="text" id="appealable" style="display: none;" required>
                <option value=''></option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
              <input type="text" placeholder="Name" id='namefield' maxlength="20" style="display: none;" required />
              <input type="text" placeholder="Steam_ID" id='steamidfield' maxlength="25" style="display: none;" required />
              <input type="text" placeholder="Discord ID" id='discordidfield' maxlength="25" style="display: none;" required />
              <input type="email" placeholder="Email Address" id='emailfield' maxlength="40" required />
              <label for="rctypefield" id='rctypelabel'>Rank Change Type:</label>
              <select type="text" id="rctypefield" style='display: block;' required>
                <option value=''></option>
                <option value='Promotion'>Promotion</option>
                <option value="Demotion">Demotion</option>
                <option value="Removal">Removal</option>
              </select>
              <label for="enddatefield" id="enddatelabelLOA" style="display: none;">Select end date of LOA:</label>
              <label for="enddatefield" id="enddatelabelBL" style="display: none;">Select expiry date of
                Blacklist:</label>
              <input type="date" placeholder="dd-mm-yyyy" id='enddatefield' style="display: none;" required />
              <input type="text" placeholder="Reason" id='reasonfield' maxlength="70" required />
              <button onclick="SubmitLog(event)" type="submit" class="submitButton" id="loggerSubmitButton">Submit</button>
              <p id="disclaimerText"></p>
            </form>
          </div>

          <script>
            // MANAGE VISIBILITY ON EDITS
            function InfoHideCheck() {
              const infotype = document.getElementById('infoTypeList').value;
              switch (infotype) {
                case 'Edit Name':
                  document.getElementById('newnamefield').setAttribute('style', 'display: block;');
                  document.getElementById('newsteamidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newsdiscidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newemailfield').setAttribute('style', 'display: none;');
                  document.getElementById('newnotesfield').setAttribute('style', 'display: none;');
                  document.getElementById('specfield').setAttribute('style', 'display: none;');
                  break;
                case 'Edit steamID':
                  document.getElementById('newnamefield').setAttribute('style', 'display: none;');
                  document.getElementById('newsteamidfield').setAttribute('style', 'display: block;');
                  document.getElementById('newsdiscidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newemailfield').setAttribute('style', 'display: none;');
                  document.getElementById('newnotesfield').setAttribute('style', 'display: none;');
                  document.getElementById('specfield').setAttribute('style', 'display: none;');
                  break;
                case 'Edit discordID':
                  document.getElementById('newnamefield').setAttribute('style', 'display: none;');
                  document.getElementById('newsteamidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newsdiscidfield').setAttribute('style', 'display: block;');
                  document.getElementById('newemailfield').setAttribute('style', 'display: none;');
                  document.getElementById('newnotesfield').setAttribute('style', 'display: none;');
                  document.getElementById('specfield').setAttribute('style', 'display: none;');
                  break;
                case 'Edit Email':
                  document.getElementById('newnamefield').setAttribute('style', 'display: none;');
                  document.getElementById('newsteamidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newsdiscidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newemailfield').setAttribute('style', 'display: block;');
                  document.getElementById('newemailfield').maxlength = 70;
                  document.getElementById('newnotesfield').setAttribute('style', 'display: none;');
                  document.getElementById('specfield').setAttribute('style', 'display: none;');
                  break;
                case 'Edit Specialization':
                  document.getElementById('newnamefield').setAttribute('style', 'display: none;');
                  document.getElementById('newsteamidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newsdiscidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newemailfield').setAttribute('style', 'display: none;');
                  document.getElementById('newnotesfield').setAttribute('style', 'display: none;');
                  document.getElementById('specfield').setAttribute('style', 'display: block;');
                  break;
                case 'Edit Note':
                  document.getElementById('newnamefield').setAttribute('style', 'display: none;');
                  document.getElementById('newsteamidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newsdiscidfield').setAttribute('style', 'display: none;');
                  document.getElementById('newemailfield').setAttribute('style', 'display: none;');
                  document.getElementById('newnotesfield').setAttribute('style', 'display: block;');
                  document.getElementById('specfield').setAttribute('style', 'display: none;');
                  break;
              }
            }

            // Submit Edit Data
            function SubmitEdit(event) {
              event.preventDefault();
              console.time("Edit Submission Runtime");
              const button = document.getElementById("editSubmitButton");
              button.disabled = true;

              const editdata = {
                type: document.getElementById('infoTypeList')?.value || '',
                current_email: document.getElementById('curremailfield')?.value || '',
                name: document.getElementById('newnamefield')?.value || '',
                steamid: document.getElementById('newsteamidfield')?.value || '',
                discordid: document.getElementById('newsdiscidfield')?.value || '',
                email: document.getElementById('newemailfield')?.value || '',
                specialization: document.getElementById('specfield')?.value || '',
                notes: document.getElementById('newnotesfield')?.value || ''
              };

              let validEdit = false;
              switch (editdata.type) {
                case 'Edit Name':
                  if (editdata.name != '' && editdata.current_email != '') { validEdit = true; }
                  break;
                case 'Edit steamID':
                  if (editdata.steamid != '' && editdata.current_email != '') { validEdit = true; }
                  break;
                case 'Edit dicsordID':
                  if (editdata.discordid != '' && editdata.current_email != '') { validEdit = true; }
                  break;
                case 'Edit Email':
                  if (editdata.email != '' && editdata.current_email != '') { validEdit = true; }
                  break;
                case 'Edit Specialization':
                  if (editdata.current_email != '') { validEdit = true; }
                  break;
                case 'Edit Note':
                  if (editdata.notes != '' && editdata.current_email != '') { validEdit = true; }
                  break;
              }

              Object.values(editdata).forEach(value => {
              if (value && (value.includes('"') || value.includes("'") || value.includes("`") || value.includes("$") || value.includes("{"))) {
                valid = false;
              }
            });

            if (!valid) {
              Shake();
              button.innerText = "No special characters allowed in input values";
              button.disabled = true;
              setTimeout(() => {
                button.innerText = "Submit New Rank";
                button.disabled = false;
              }, 2000);
              return;
            }

              if (validEdit == true) {
                button.innerText = "";
                button.innerHTML = '<div class="loader"></div>';
                google.script.run.withSuccessHandler(response => {

                  if (response.includes("not")) {
                    Shake();
                    button.classList.add('red');
                  } else if (!response.includes('something')) {
                    document.getElementById('editform').reset();
                    InfoHideCheck();
                    button.classList.add('green');
                  }

                  // Manipulating button text to give info to user.
                  button.innerHTML = "";
                  button.innerText = response;
                  setTimeout(() => {
                    button.innerText = "Submit";
                    button.disabled = false;
                    button.classList.remove('red');
                    button.classList.remove('green');
                  }, 4000);
                  console.timeEnd("Edit Submission Runtime");
                }).withFailureHandler(error => {
                  //

                  // Manipulating button text to give info to user.
                  button.innerHTML = "";
                  button.innerText = "Something went wrong";
                  setTimeout(() => {
                    button.innerText = "Submit";
                    button.disabled = false;
                  }, 4000);
                  console.timeEnd("Edit Submission Runtime");
                }).ProcessInputEdits(editdata);
              } else if (validEdit == false) {
                // Make screen shake if not all questions were answered (idk seemed fun)
                Shake();
                console.log("You did not fill out all questions correctly -- Submission failed");
                button.disabled = false;
                console.timeEnd("Edit Submission Runtime");
              }
            }

            document.addEventListener("DOMContentLoaded", function () {

              SetSpecSelects();

              document.getElementById('curremailfield').addEventListener('change', () => {
                const emailField = document.getElementById('curremailfield');
                const elements = ["newnamefield", "newsteamidfield", "newsdiscidfield", "newnotesfield"];
                const button = document.getElementById('editSubmitButton');

                emailField.disabled = true;
                button.disabled = true;
                elements.forEach(elementId => document.getElementById(elementId).disabled = true);
                button.innerText = "";
                button.innerHTML = '<div class="loader"></div>';

                google.script.run.withSuccessHandler(targetData => {
                  try {
                    targetData = JSON.parse(targetData);
                    if (!targetData.row) {
                      elements.forEach(element => document.getElementById(element[0]).value = "");
                      elements.forEach(elementId => document.getElementById(elementId).disabled = false);
                      emailField.disabled = false;
                      button.disabled = false;
                      button.innerHTML = '';
                      button.innerText = "Submit";
                      return;
                    }

                    document.getElementById(elements[0]).value = targetData.name;
                    document.getElementById(elements[1]).value = targetData.steamId;
                    document.getElementById(elements[2]).value = targetData.discordId;
                    document.getElementById(elements[3]).value = targetData.notes;

                    elements.forEach(elementId => document.getElementById(elementId).disabled = false);
                    emailField.disabled = false;
                    button.disabled = false;
                    button.innerHTML = '';
                    button.innerText = "Submit";
                  } catch (e) {
                    
                    emailField.disabled = false;
                    button.disabled = false;
                    elements.forEach(elementId => document.getElementById(elementId).disabled = false);
                    button.innerHTML = '';
                    button.innerText = "Submit";
                  }
                }).withFailureHandler(error => {
                  
                  
                  emailField.disabled = false;
                  button.disabled = false;
                  elements.forEach(elementId => document.getElementById(elementId).disabled = false);
                  button.innerHTML = '';
                  button.innerText = "Submit";
                }).ReturnUserData(emailField.value, true);
              });

              let specInterval;
              document.getElementById("infoTypeList").addEventListener("change", () => {
                if (document.getElementById("infoTypeList").value === "Edit Specialization") {
                  SetSpecSelects();
                  specInterval = setInterval(() => { SetSpecSelects() }, 10000);
                } else {
                  try { clearInterval(specInterval) } catch(e) { }
                }
              });
            });
          </script>
          <div id="editForm" style="display: none;">
            <form id="editform">
              <h1>Staff Roster Info Editor Form</h1>
              <br>
              <p>Please fill out <strong>all</strong> the below questions in order to submit an edit.</p>
              <p>Before submitting, double-check your answers as once you press the button, they can no longer be
                adjusted.</p>
              <br>
              <hr><br>
              <h3>Roster Edit Information</h3>
              <select id="infoTypeList" onchange="InfoHideCheck()">
                <option value="Edit Name">Edit Name</option>
                <option value="Edit steamID">Edit Steam_ID</option>
                <option value="Edit discordID">Edit Discord ID</option>
                <option value="Edit Email">Edit Email Address</option>
                <option value="Edit Specialization">Edit Specialization</option>
                <option value="Edit Note">Edit Notes</option>
              </select>
              <hr>
              <label for="curremailfield" id="curremaillabel">Enter the Email address of the member you want to apply an
                edit to:</label>
              <input type="text" placeholder="Enter current Email Address" id="curremailfield" required />
              <hr><br>
              <input type="text" placeholder="Enter new name" id="newnamefield" maxlength="20" required />
              <input type="text" placeholder="Enter new steamID" id="newsteamidfield" style="display: none;"
                maxlength="25" required />
              <input type="text" placeholder="Enter new discord ID" id="newsdiscidfield" style="display: none;"
                maxlength="25" required />
              <input type="email" placeholder="Enter new Email Address" id="newemailfield" style="display: none;"
                maxlength="70" required />
              <select id="specfield" style="display: none;">
                <option value=""></option>
              </select>
              <input type="text" placeholder="Enter new Extra Notes" id="newnotesfield" style="display: none;"
                maxlength="125" required />
              <button onclick="SubmitEdit(event)" type="submit" class="submitButton" id="editSubmitButton">Submit</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>